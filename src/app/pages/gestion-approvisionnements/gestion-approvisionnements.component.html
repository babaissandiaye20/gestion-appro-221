<div class="gestion-container">
  <div class="header">
    <h1>Gestion des Approvisionnements</h1>
    <button class="btn btn-primary" (click)="nouveauApprovisionnement()">
      + Nouvel approvisionnement
    </button>
  </div>

  <!-- Filtres et recherche -->
  <div class="filters-section">
    <h2 class="section-title">Filtres et recherche</h2>

    <form [formGroup]="filterForm" class="filters-form">
      <div class="filters-row">
        <div class="filter-group search-group">
          <input
            type="text"
            formControlName="recherche"
            class="form-control search-input"
            placeholder="Rechercher..."
          />
          <button class="btn-search" type="button">
            üîç
          </button>
        </div>

        <div class="filter-group">
          <select formControlName="fournisseur" class="form-control">
            <option value="">Tous les fournisseurs</option>
            <option *ngFor="let fournisseur of fournisseurs" [value]="fournisseur.id">
              {{ fournisseur.nom }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <select formControlName="article" class="form-control">
            <option value="">Tous les articles</option>
            <option *ngFor="let article of articles" [value]="article.id">
              {{ article.nom }}
            </option>
          </select>
        </div>
      </div>

      <div class="filters-row">
        <div class="filter-group">
          <label>Du</label>
          <input
            type="date"
            formControlName="dateDebut"
            class="form-control"
          />
        </div>

        <div class="filter-group">
          <label>Au</label>
          <input
            type="date"
            formControlName="dateFin"
            class="form-control"
          />
        </div>

        <div class="filter-actions">
          <button
            type="button"
            class="btn btn-primary btn-filter"
            (click)="appliquerFiltres()"
          >
            üîç Filtrer
          </button>
          <button
            type="button"
            class="btn btn-secondary btn-reset"
            (click)="reinitialiserFiltres()"
          >
            üîÑ R√©initialiser
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- Tableau des approvisionnements -->
  <div class="table-section">
    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button
        class="btn-page"
        (click)="changerPage(currentPage - 1)"
        [disabled]="currentPage === 1"
      >
        Pr√©c√©dent
      </button>

      <button
        *ngFor="let page of pages"
        class="btn-page"
        [class.active]="page === currentPage"
        (click)="changerPage(page)"
      >
        {{ page }}
      </button>

      <button
        class="btn-page"
        (click)="changerPage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
      >
        Suivant
      </button>
    </div>

    <div class="table-wrapper">
      <table class="approvisionnements-table">
        <thead>
          <tr>
            <th>R√©f√©rence</th>
            <th>Date</th>
            <th>Fournisseur</th>
            <th>Articles</th>
            <th>Montant total</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="approvisionnementsFiltres.length === 0">
            <td colspan="7" class="empty-state">
              Aucun approvisionnement trouv√©
            </td>
          </tr>
          <tr *ngFor="let appro of approvisionnementsFiltres">
            <td class="ref-cell">{{ appro.reference }}</td>
            <td>{{ appro.date | date:'dd/MM/yyyy' }}</td>
            <td>{{ appro.fournisseur }}</td>
            <td>
              <div class="articles-badges">
                <span
                  *ngFor="let article of appro.articles.slice(0, 3)"
                  class="badge badge-article"
                >
                  {{ article }}
                </span>
                <span
                  *ngIf="appro.articles.length > 3"
                  class="badge badge-more"
                >
                  +{{ appro.articles.length - 3 }}
                </span>
              </div>
            </td>
            <td class="montant-cell">{{ appro.montantTotal | number:'1.0-0' }} FCFA</td>
            <td>
              <span
                class="badge badge-statut"
                [ngClass]="{
                  'badge-recu': appro.statut === 'Re√ßu',
                  'badge-attente': appro.statut === 'En attente'
                }"
              >
                {{ appro.statut }}
              </span>
            </td>
            <td>
              <div class="actions-cell">
                <button class="btn-square is-view" type="button"
                        (click)="voirDetails(appro.id)" title="Voir" aria-label="Voir">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                  </svg>
                </button>
                <button class="btn-square is-edit" type="button"
                        (click)="modifier(appro.id)" title="Modifier" aria-label="Modifier">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M3 17.25V21h3.75L19.81 7.94l-3.75-3.75L3 17.25z" fill="currentColor"/>
                  </svg>
                </button>
                <button class="btn-square is-delete" type="button"
                        (click)="supprimer(appro.id)" title="Supprimer" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M19 6H5m2 0l1-2h8l1 2m-1 0l-1 14H9L8 6" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Pagination ‚Äî version visible tout de suite -->
  <nav class="pagination" aria-label="Pagination">
    <button class="btn-page" disabled>Pr√©c√©dent</button>
    <button class="btn-page active">1</button>
    <button class="btn-page">2</button>
    <button class="btn-page">3</button>
    <button class="btn-page">Suivant</button>
  </nav>



  <!-- Statistiques -->
  <div class="stats-section">
    <div class="stat-card">
      <h3>Total des approvisionnements</h3>
      <p class="stat-value">{{ statistiques.totalMontant | number:'1.0-0' }} FCFA</p>
      <span class="stat-period">P√©riode: {{ statistiques.periode }}</span>
    </div>

    <div class="stat-card">
      <h3>Nombre d'approvisionnements</h3>
      <p class="stat-value">{{ statistiques.nombreTotal }}</p>
      <span class="stat-period">P√©riode: {{ statistiques.periode }}</span>
    </div>

    <div class="stat-card stat-highlight">
      <h3>Fournisseur principal</h3>
      <p class="stat-value stat-fournisseur">{{ statistiques.fournisseurPrincipal }}</p>
      <span class="stat-period">{{ statistiques.montantFournisseurPrincipal | number:'1.0-0' }} FCFA ({{ statistiques.pourcentageFournisseurPrincipal }}%)</span>
    </div>
  </div>
</div>
